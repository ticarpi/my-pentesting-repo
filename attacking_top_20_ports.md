# Attacking the Top 20 TCP Ports

This is a breakdown of some useful attack vectors that will get you started on 95% of targets in a pentest.


## Nmap Top 20 TCP ports
* 21/tcp == ftp
* 22/tcp == ssh*
* 23/tcp == telnet
* 25/tcp == smtp
* 53/tcp == dns
* 80/tcp == http
* 110/tcp == pop3
* 111/tcp == rpcbind (?)     
* 135/tcp == msrpc (?)   
* 139/tcp == netbios-ssn
* 143/tcp == imap
* 443/tcp == https*
* 445/tcp == microsoft-ds
* 993/tcp == imaps* 
* 995/tcp == pop3s*    
* 1723/tcp == pptp*  
* 3306/tcp == mysql
* 3389/tcp == ms-wbt-server (?)           
* 5900/tcp == vnc*   
* 8080/tcp == http-proxy
     
**Encrypted ports*  

---

## Attack Methodology

### First up ***identify your ports***!  
> Make sure you check all ports on TCP and UDP.  

Your friend here is `unicornscan` - this is also leveraged by `onetwopunch.sh` ([https://github.com/superkojiman/onetwopunch](https://github.com/superkojiman/onetwopunch)).  

Use **version detection** in `nmap` (-sV) to grab banners and detect more enumeration data - which can lead to identifying weaknesses and exploits.

For any given port/service the most effective 'way in' for a Pentester can be achieved by following a structured analysis approach.  
Check for a weakness per category and then proceed to the next until you find a way in:
1. Can you already interact with the open port?
1. Inherent weaknesses
1. Weak configurations
1. Basic credential checks
1. Known exploits
1. Complex credential checks
1. New exploits

### Creds to check
Basic:
* No credentials
* Default credentials
* Bypassable credentials
* Guessable credentials (common lists)
* Reused credentials

Complex:  
* Brute-forceable credentials
* Crackable credentials (wordlists and rules)

---

## Port Details

### 21 - FTP (*File Transfer Protocol*)
**Purpose:** *Transfer of files using a remote, browsable directory*

#### Common software/daemon  
* `vsftpd`

#### Risk/vector(s)  

C|I|A
-|-|-
X|X|0

* Username enumeration
* File exposure/access:
  * `~/.ssh` or other config files
  * `~/.bash_history` or other log files
  * source code
* File upload

#### Tools/Commands to interact/attack  
* **ftp**
  * `$ ftp <ip_addr>`  
* **netcat**
  * `nc <ip_addr> <port>`
* **hydra** - brute-force login

#### Routes to exploit 
* Enumerate usernames
* Brute-force login

#### Common misconfigurations/weaknesses  
* Anonymous FTP - read files
* Anonymous FTP - write files
* Lack of bruteforce prevention
* Often unpatched
* Unencrypted communication
* FTPd service running as Admin on Windows systems

#### Common exploits  
* CVEs:
  * `vsftpd` CVEs:
  * others
* MitM (if local)

#### Default creds  
* anonymous:<:blank:>
* anonymous:<any_email_addr>

---

### 22 - SSH (*Secure Shell*)
**Purpose:** *Remote shell access via encrypted connection*

#### Common software/daemon  
* `openssh`

#### Risk/vector(s)  

C|I|A
-|-|-
X|X|0

* Username enumeration
* RCE
* File exposure/access
* File upload

#### Tools/Commands to interact/attack  
* **ssh**
  * `$ ssh <ip_addr> <port>`
  * `$ ssh username@<ip_addr> <port>`
* **openssl**
  * `$ openssl s_client -connect <ip_addr>:<port> -crlf`
* **hydra** - bruteforce login attacks

#### Routes to exploit 
* Brute-force login
* Enumerate usernames

#### Common misconfigurations/weaknesses  
* Weak creds
* Shared creds
* Lack of bruteforce prevention

#### Common exploits  
* CVEs:
  * `opensshd` CVEs:
  * others

#### Default creds  
* none

---

### 23 - Telnet
**Purpose:** *Unencrypted remote shell access*

#### Common software/daemon  
* `telnet`
* `telnetd`

#### Risk/vector(s)  

C|I|A
-|-|-
X|X|0

* Username enumeration
* RCE
* Sensitive file exposure
* File upload

#### Tools/Commands to interact/attack  
* **telnet**
  * `$ telnet <ip_addr>`
* **netcat**
  * `$nc <ip_addr> <port>`
* **hydra** - brute-force login

#### Routes to exploit
* Brute-force login

#### Common misconfigurations/weaknesses  
* Break out of served software - if unprotected

#### Common exploits  
* MitM (if local)

#### Default creds  
* none

---


---
## Template

### Port# - Service (*Service Description*)
**Purpose:** *Transfer of files using a remote, browsable directory*

#### Common software/daemon  
* `vsftpd`

#### Risk/vector(s)  

C|I|A
-|-|-
X|X|0

* Username enumeration

#### Tools/Commands to interact/attack  
* **ftp**
  * `$ ftp <ip_addr>`

#### Routes to exploit
* Access sensitive files:
  * `~/.ssh` or other config files

#### Common misconfigurations/weaknesses  
* Anonymous FTP - read files

#### Common exploits  
* MitM (if local)
* CVEs:
  * `this_program` CVEs:

#### Default creds  
* admin:<_blank_> 


---


25
53
80
110
111
135
139
143
443
445
993
995
1723
3306
3389
5900
8080

---

### 

#### What?

#### Usage

#### Common Weaknesses

#### Attack Strategy


IMAP/POP3 data:
http://www.suburbancomputer.com/tips_email.htm
https://donsutherland.org/crib/imap
